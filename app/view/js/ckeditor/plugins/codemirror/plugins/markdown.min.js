!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror",require("../xml/xml"))):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml"],t):t(CodeMirror)}(function(t){"use strict";t.defineMode("markdown",function(e,n){var i=t.modes.hasOwnProperty("xml"),r=t.getMode(e,i?{name:"xml",htmlMode:!0}:"text/plain"),a={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"},o=function(){var n,i={},r={},o=[];for(var l in t.modes)t.modes.propertyIsEnumerable(l)&&o.push(l);for(n=0;n<o.length;n++)i[o[n]]=o[n];var s=[];for(var l in t.mimeModes)t.mimeModes.propertyIsEnumerable(l)&&s.push({mime:l,mode:t.mimeModes[l]});for(n=0;n<s.length;n++)r[s[n].mime]=s[n].mime;for(var h in a)(a[h]in i||a[h]in r)&&(i[h]=a[h]);return function(n){return i[n]?t.getMode(e,i[n]):null}}();void 0===n.highlightFormatting&&(n.highlightFormatting=!1),void 0===n.maxBlockquoteDepth&&(n.maxBlockquoteDepth=0),void 0===n.underscoresBreakWords&&(n.underscoresBreakWords=!0),void 0===n.fencedCodeBlocks&&(n.fencedCodeBlocks=!1),void 0===n.taskLists&&(n.taskLists=!1);var l=0,s="header",h="comment",f="quote",c="variable-2",m="variable-3",g="keyword",u="hr",d="tag",p="formatting",k="link",v="link",x="link",S="string",L="em",b="strong",F=/^([*\-=_])(?:\s*\1){2,}\s*$/,M=/^[*\-+]\s+/,q=/^[0-9]+\.\s+/,w=/^\[(x| )\](?=\s)/,C=/^#+/,D=/^(?:\={1,}|-{1,})$/,H=/^[^#!\[\]*_\\<>` "'(]+/;function T(t,e,n){return e.f=e.inline=n,n(t,e)}function y(t,e,n){return e.f=e.block=n,n(t,e)}function B(t){return t.linkTitle=!1,t.em=!1,t.strong=!1,t.quote=0,i||t.f!=_||(t.f=O,t.block=j),t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.thisLineHasContent=!1,null}function j(t,e){var i=t.sol(),r=!1!==e.list;!1!==e.list&&e.indentationDiff>=0?(e.indentationDiff<4&&(e.indentation-=e.indentationDiff),e.list=null):!1!==e.list&&e.indentation>0?(e.list=null,e.listDepth=Math.floor(e.indentation/4)):!1!==e.list&&(e.list=!1,e.listDepth=0);var a=null;if(e.indentationDiff>=4)return e.indentation-=4,t.skipToEnd(),h;if(t.eatSpace())return null;if(a=t.match(C))return e.header=a[0].length<=6?a[0].length:6,n.highlightFormatting&&(e.formatting="header"),e.f=e.inline,E(e);if(e.prevLineHasContent&&(a=t.match(D)))return e.header="="==a[0].charAt(0)?1:2,n.highlightFormatting&&(e.formatting="header"),e.f=e.inline,E(e);if(t.eat(">"))return e.indentation++,e.quote=i?1:e.quote+1,n.highlightFormatting&&(e.formatting="quote"),t.eatSpace(),E(e);if("["===t.peek())return T(t,e,R);if(t.match(F,!0))return u;if((!e.prevLineHasContent||r)&&(t.match(M,!1)||t.match(q,!1))){var l=null;return t.match(M,!0)?l="ul":(t.match(q,!0),l="ol"),e.indentation+=4,e.list=!0,e.listDepth++,n.taskLists&&t.match(w,!1)&&(e.taskList=!0),e.f=e.inline,n.highlightFormatting&&(e.formatting=["list","list-"+l]),E(e)}return n.fencedCodeBlocks&&t.match(/^```([\w+#]*)/,!0)?(e.localMode=o(RegExp.$1),e.localMode&&(e.localState=e.localMode.startState()),y(t,e,$),n.highlightFormatting&&(e.formatting="code-block"),e.code=!0,E(e)):T(t,e,e.inline)}function _(t,e){var n=r.token(t,e.htmlState);return(i&&null===e.htmlState.tagStart&&!e.htmlState.context||e.md_inside&&t.current().indexOf(">")>-1)&&(e.f=O,e.block=j,e.htmlState=null),n}function $(t,e){if(t.sol()&&t.match(/^```/,!0)){e.localMode=e.localState=null,e.f=O,e.block=j,n.highlightFormatting&&(e.formatting="code-block"),e.code=!0;var i=E(e);return e.code=!1,i}return e.localMode?e.localMode.token(t,e.localState):(t.skipToEnd(),h)}function E(t){var e=[];if(t.formatting){e.push(p),"string"==typeof t.formatting&&(t.formatting=[t.formatting]);for(var i=0;i<t.formatting.length;i++)e.push(p+"-"+t.formatting[i]),"header"===t.formatting[i]&&e.push(p+"-"+t.formatting[i]+"-"+t.header),"quote"===t.formatting[i]&&(!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=t.quote?e.push(p+"-"+t.formatting[i]+"-"+t.quote):e.push("error"))}if(t.taskOpen)return e.push("meta"),e.length?e.join(" "):null;if(t.taskClosed)return e.push("property"),e.length?e.join(" "):null;if(t.linkHref)return e.push(S),e.length?e.join(" "):null;if(t.strong&&e.push(b),t.em&&e.push(L),t.linkText&&e.push(x),t.code&&e.push(h),t.header&&(e.push(s),e.push(s+"-"+t.header)),t.quote&&(e.push(f),!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=t.quote?e.push(f+"-"+t.quote):e.push(f+"-"+n.maxBlockquoteDepth)),!1!==t.list){var r=(t.listDepth-1)%3;r?1===r?e.push(m):e.push(g):e.push(c)}return t.trailingSpaceNewLine?e.push("trailing-space-new-line"):t.trailingSpace&&e.push("trailing-space-"+(t.trailingSpace%2?"a":"b")),e.length?e.join(" "):null}function N(t,e){if(t.match(H,!0))return E(e)}function O(e,i){var a=i.text(e,i);if(void 0!==a)return a;if(i.list)return i.list=null,E(i);if(i.taskList)return"x"!==e.match(w,!0)[1]?i.taskOpen=!0:i.taskClosed=!0,n.highlightFormatting&&(i.formatting="task"),i.taskList=!1,E(i);if(i.taskOpen=!1,i.taskClosed=!1,i.header&&e.match(/^#+$/,!0))return n.highlightFormatting&&(i.formatting="header"),E(i);var o=e.sol(),s=e.next();if(i.escape)return i.escape=!1,E(i);if("\\"===s)return n.highlightFormatting&&(i.formatting="escape"),i.escape=!0,E(i);if(i.linkTitle){i.linkTitle=!1;var h=s;"("===s&&(h=")");var f="^\\s*(?:[^"+(h=(h+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"))+"\\\\]+|\\\\\\\\|\\\\.)"+h;if(e.match(new RegExp(f),!0))return S}if("`"===s){var c=i.formatting;n.highlightFormatting&&(i.formatting="code");var m=E(i),g=e.pos;e.eatWhile("`");var u=1+e.pos-g;return i.code?u===l?(i.code=!1,m):(i.formatting=c,E(i)):(l=u,i.code=!0,E(i))}if(i.code)return E(i);if("!"===s&&e.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return e.match(/\[[^\]]*\]/),i.inline=i.f=I,d;if("["===s&&e.match(/.*\](\(| ?\[)/,!1))return i.linkText=!0,n.highlightFormatting&&(i.formatting="link"),E(i);if("]"===s&&i.linkText){n.highlightFormatting&&(i.formatting="link");var p=E(i);return i.linkText=!1,i.inline=i.f=I,p}if("<"===s&&e.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return i.f=i.inline=W,n.highlightFormatting&&(i.formatting="link"),(p=E(i))?p+=" ":p="",p+k;if("<"===s&&e.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return i.f=i.inline=W,n.highlightFormatting&&(i.formatting="link"),(p=E(i))?p+=" ":p="",p+v;if("<"===s&&e.match(/^\w/,!1)){if(-1!=e.string.indexOf(">")){var x=e.string.substring(1,e.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(x)&&(i.md_inside=!0)}return e.backUp(1),i.htmlState=t.startState(r),y(e,i,_)}if("<"===s&&e.match(/^\/\w*?>/))return i.md_inside=!1,"tag";var L=!1;if(!n.underscoresBreakWords&&"_"===s&&"_"!==e.peek()&&e.match(/(\w)/,!1)){var b=e.pos-2;if(b>=0){var F=e.string.charAt(b);"_"!==F&&F.match(/(\w)/,!1)&&(L=!0)}}if("*"===s||"_"===s&&!L)if(o&&" "===e.peek());else{if(i.strong===s&&e.eat(s)){n.highlightFormatting&&(i.formatting="strong");m=E(i);return i.strong=!1,m}if(!i.strong&&e.eat(s))return i.strong=s,n.highlightFormatting&&(i.formatting="strong"),E(i);if(i.em===s){n.highlightFormatting&&(i.formatting="em");m=E(i);return i.em=!1,m}if(!i.em)return i.em=s,n.highlightFormatting&&(i.formatting="em"),E(i)}else if(" "===s&&(e.eat("*")||e.eat("_"))){if(" "===e.peek())return E(i);e.backUp(1)}return" "===s&&(e.match(/ +$/,!1)?i.trailingSpace++:i.trailingSpace&&(i.trailingSpaceNewLine=!0)),E(i)}function W(t,e){if(">"===t.next()){e.f=e.inline=O,n.highlightFormatting&&(e.formatting="link");var i=E(e);return i?i+=" ":i="",i+k}return t.match(/^[^>]+/,!0),k}function I(t,e){if(t.eatSpace())return null;var i,r=t.next();return"("===r||"["===r?(e.f=e.inline=(i="("===r?")":"]",function(t,e){var r,a=t.next();if(a===i){e.f=e.inline=O,n.highlightFormatting&&(e.formatting="link-string");var o=E(e);return e.linkHref=!1,o}return t.match((P[r=i]||(r=(r+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),P[r]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+r+")")),P[r]),!0)&&t.backUp(1),e.linkHref=!0,E(e)}),n.highlightFormatting&&(e.formatting="link-string"),e.linkHref=!0,E(e)):"error"}function R(t,e){return t.match(/^[^\]]*\]:/,!1)?(e.f=U,t.next(),n.highlightFormatting&&(e.formatting="link"),e.linkText=!0,E(e)):T(t,e,O)}function U(t,e){if(t.match(/^\]:/,!0)){e.f=e.inline=A,n.highlightFormatting&&(e.formatting="link");var i=E(e);return e.linkText=!1,i}return t.match(/^[^\]]+/,!0),x}function A(t,e){return t.eatSpace()?null:(t.match(/^[^\s]+/,!0),void 0===t.peek()?e.linkTitle=!0:t.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),e.f=e.inline=O,S)}var P=[];var z={startState:function(){return{f:j,prevLineHasContent:!1,thisLineHasContent:!1,block:j,htmlState:null,indentation:0,inline:O,text:N,escape:!1,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1}},copyState:function(e){return{f:e.f,prevLineHasContent:e.prevLineHasContent,thisLineHasContent:e.thisLineHasContent,block:e.block,htmlState:e.htmlState&&t.copyState(r,e.htmlState),indentation:e.indentation,localMode:e.localMode,localState:e.localMode?t.copyState(e.localMode,e.localState):null,inline:e.inline,text:e.text,escape:!1,formatting:!1,linkTitle:e.linkTitle,em:e.em,strong:e.strong,header:e.header,taskList:e.taskList,list:e.list,listDepth:e.listDepth,quote:e.quote,trailingSpace:e.trailingSpace,trailingSpaceNewLine:e.trailingSpaceNewLine,md_inside:e.md_inside}},token:function(t,e){if(e.formatting=!1,t.sol()){var n=t.match(/^\s*$/,!0)||e.header;if(e.header=0,n)return e.prevLineHasContent=!1,B(e);e.prevLineHasContent=e.thisLineHasContent,e.thisLineHasContent=!0,e.escape=!1,e.taskList=!1,e.code=!1,e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.f=e.block;var i=t.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,r=4*Math.floor((i-e.indentation)/4);r>4&&(r=4);var a=e.indentation+r;if(e.indentationDiff=a-e.indentation,e.indentation=a,i>0)return null}var o=e.f(t,e);return t.start==t.pos?this.token(t,e):o},innerMode:function(t){return t.block==_?{state:t.htmlState,mode:r}:t.localState?{state:t.localState,mode:t.localMode}:{state:t,mode:z}},blankLine:B,getType:E,fold:"markdown"};return z},"xml"),t.defineMIME("text/x-markdown","markdown")});