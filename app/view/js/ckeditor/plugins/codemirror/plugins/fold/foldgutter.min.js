!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],t):t(CodeMirror)}(function(t){"use strict";t.defineOption("foldGutter",!1,function(o,e,r){r&&r!=t.Init&&(o.clearGutter(o.state.foldGutter.options.gutter),o.state.foldGutter=null,o.off("gutterClick",i),o.off("change",f),o.off("viewportChange",d),o.off("fold",u),o.off("unfold",u),o.off("swapDoc",n)),e&&(o.state.foldGutter=new function(t){this.options=t,this.from=this.to=0}(function(t){!0===t&&(t={});null==t.gutter&&(t.gutter="CodeMirror-foldgutter");null==t.indicatorOpen&&(t.indicatorOpen="CodeMirror-foldgutter-open");null==t.indicatorFolded&&(t.indicatorFolded="CodeMirror-foldgutter-folded");return t}(e)),n(o),o.on("gutterClick",i),o.on("change",f),o.on("viewportChange",d),o.on("fold",u),o.on("unfold",u),o.on("swapDoc",n))});var o=t.Pos;function e(t){if("string"==typeof t){var o=document.createElement("div");return o.className=t+" CodeMirror-guttermarker-subtle",o}return t.cloneNode(!0)}function r(r,n,i){var f=r.state.foldGutter.options,d=n;r.eachLine(n,i,function(n){var i=null;if(function(t,e){for(var r=t.findMarksAt(o(e)),n=0;n<r.length;++n)if(r[n].__isFold&&r[n].find().from.line==e)return!0}(r,d))i=e(f.indicatorFolded);else{var u=o(d,0),a=f.rangeFinder||t.fold.auto,l=a&&a(r,u);l&&l.from.line+1<l.to.line&&(i=e(f.indicatorOpen))}r.setGutterMarker(n,f.gutter,i),++d})}function n(t){var o=t.getViewport(),e=t.state.foldGutter;e&&(t.operation(function(){r(t,o.from,o.to)}),e.from=o.from,e.to=o.to)}function i(t,e,r){var n=t.state.foldGutter.options;r==n.gutter&&t.foldCode(o(e,0),n.rangeFinder)}function f(t){var o=t.state.foldGutter,e=t.state.foldGutter.options;o.from=o.to=0,clearTimeout(o.changeUpdate),o.changeUpdate=setTimeout(function(){n(t)},e.foldOnChangeTimeSpan||600)}function d(t){var o=t.state.foldGutter,e=t.state.foldGutter.options;clearTimeout(o.changeUpdate),o.changeUpdate=setTimeout(function(){var e=t.getViewport();o.from==o.to||e.from-o.to>20||o.from-e.to>20?n(t):t.operation(function(){e.from<o.from&&(r(t,e.from,o.from),o.from=e.from),e.to>o.to&&(r(t,o.to,e.to),o.to=e.to)})},e.updateViewportTimeSpan||400)}function u(t,o){var e=t.state.foldGutter,n=o.line;n>=e.from&&n<e.to&&r(t,n,n+1)}});